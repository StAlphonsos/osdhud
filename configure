# -*- mode:sh; indent-tabs-mode:nil; sh-indentation:2 -*-
##
# configure - osdhud configure script
##
# Copyright (C) 2014-2016 by attila <attila@stalphonsos.com>
#
# Permission to use, copy, modify, and distribute this software for
# any purpose with or without fee is hereby granted, provided that the
# above copyright notice and this permission notice appear in all
# copies.
#
# THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL
# WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED
# WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE
# AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL
# DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR
# PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
# TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
# PERFORMANCE OF THIS SOFTWARE.
##
prefix=${PREFIX-/usr/local}
debugging=""

while [ $# -gt 0 ]; do
    arg=$1
    shift
    case $arg in
        --prefix=*)
            prefix=`echo $arg | sed -e 's/^--prefix=//'`
            echo $0: prefix is now $prefix
            ;;
        --debug)
            debugging="DEBUG_CFLAGS=-DDEBUG"
            ;;
        --help)
            echo 'usage: ./configure [--prefix=dir] [--debug]'
            exit 1
            ;;
        *)
            echo "$0: unrecognized argument ignored: $arg"
            ;;
    esac
done

echo PREFIX=${prefix} > config.mk
[ -n "${debugging}" ] && echo "${debugging}" >> config.mk
echo "$0: wrote config.mk"

wordsize=`perl -MConfig -e 'printf("%d\n",$Config{longsize}*8)'`
perl ./suss.pl -file=config.h WORDSIZE=$wordsize
echo "$0: wrote config.h"
